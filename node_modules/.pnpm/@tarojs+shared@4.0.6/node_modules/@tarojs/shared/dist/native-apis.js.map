{"version":3,"file":"native-apis.js","sources":["../src/native-apis.ts"],"sourcesContent":["import { isFunction, isString } from './is'\nimport { nonsupport, setUniqueKeyToRoute } from './utils'\n\ndeclare const getCurrentPages: () => any\ndeclare const getApp: () => any\ndeclare const requirePlugin: () => void\n\ntype IObject = Record<string, any>\n\ninterface IProcessApisIOptions {\n  noPromiseApis?: Set<string>\n  needPromiseApis?: Set<string>\n  handleSyncApis?: (key: string, global: IObject, args: any[]) => any\n  transformMeta?: (key: string, options: IObject) => { key: string, options: IObject }\n  modifyApis?: (apis: Set<string>) => void\n  modifyAsyncResult?: (key: string, res) => void\n  isOnlyPromisify?: boolean\n  [propName: string]: any\n}\n\nexport interface IApiDiff {\n  [key: string]: {\n    /** API重命名 */\n    alias?: string\n    options?: {\n      /** API参数键名修改 */\n      change?: {\n        old: string\n        new: string\n      }[]\n      /** API参数值修改 */\n      set?: {\n        key: string\n        value: ((options: Record<string, any>) => unknown) | unknown\n      }[]\n    }\n  }\n}\n\nconst needPromiseApis = new Set<string>([\n  'addPhoneContact',\n  'authorize',\n  'canvasGetImageData',\n  'canvasPutImageData',\n  'canvasToTempFilePath',\n  'checkSession',\n  'chooseAddress',\n  'chooseImage',\n  'chooseInvoiceTitle',\n  'chooseLocation',\n  'chooseVideo',\n  'clearStorage',\n  'closeBLEConnection',\n  'closeBluetoothAdapter',\n  'closeSocket',\n  'compressImage',\n  'connectSocket',\n  'createBLEConnection',\n  'downloadFile',\n  'exitMiniProgram',\n  'getAvailableAudioSources',\n  'getBLEDeviceCharacteristics',\n  'getBLEDeviceServices',\n  'getBatteryInfo',\n  'getBeacons',\n  'getBluetoothAdapterState',\n  'getBluetoothDevices',\n  'getClipboardData',\n  'getConnectedBluetoothDevices',\n  'getConnectedWifi',\n  'getExtConfig',\n  'getFileInfo',\n  'getImageInfo',\n  'getLocation',\n  'getNetworkType',\n  'getSavedFileInfo',\n  'getSavedFileList',\n  'getScreenBrightness',\n  'getSetting',\n  'getStorage',\n  'getStorageInfo',\n  'getSystemInfo',\n  'getUserInfo',\n  'getWifiList',\n  'hideHomeButton',\n  'hideShareMenu',\n  'hideTabBar',\n  'hideTabBarRedDot',\n  'loadFontFace',\n  'login',\n  'makePhoneCall',\n  'navigateBack',\n  'navigateBackMiniProgram',\n  'navigateTo',\n  'navigateToBookshelf',\n  'navigateToMiniProgram',\n  'notifyBLECharacteristicValueChange',\n  'hideKeyboard',\n  'hideLoading',\n  'hideNavigationBarLoading',\n  'hideToast',\n  'openBluetoothAdapter',\n  'openDocument',\n  'openLocation',\n  'openSetting',\n  'pageScrollTo',\n  'previewImage',\n  'queryBookshelf',\n  'reLaunch',\n  'readBLECharacteristicValue',\n  'redirectTo',\n  'removeSavedFile',\n  'removeStorage',\n  'removeTabBarBadge',\n  'requestSubscribeMessage',\n  'saveFile',\n  'saveImageToPhotosAlbum',\n  'saveVideoToPhotosAlbum',\n  'scanCode',\n  'sendSocketMessage',\n  'setBackgroundColor',\n  'setBackgroundTextStyle',\n  'setClipboardData',\n  'setEnableDebug',\n  'setInnerAudioOption',\n  'setKeepScreenOn',\n  'setNavigationBarColor',\n  'setNavigationBarTitle',\n  'setScreenBrightness',\n  'setStorage',\n  'setTabBarBadge',\n  'setTabBarItem',\n  'setTabBarStyle',\n  'showActionSheet',\n  'showFavoriteGuide',\n  'showLoading',\n  'showModal',\n  'showShareMenu',\n  'showTabBar',\n  'showTabBarRedDot',\n  'showToast',\n  'startBeaconDiscovery',\n  'startBluetoothDevicesDiscovery',\n  'startDeviceMotionListening',\n  'startPullDownRefresh',\n  'stopBeaconDiscovery',\n  'stopBluetoothDevicesDiscovery',\n  'stopCompass',\n  'startCompass',\n  'startAccelerometer',\n  'stopAccelerometer',\n  'showNavigationBarLoading',\n  'stopDeviceMotionListening',\n  'stopPullDownRefresh',\n  'switchTab',\n  'uploadFile',\n  'vibrateLong',\n  'vibrateShort',\n  'writeBLECharacteristicValue'\n])\n\nfunction getCanIUseWebp (taro) {\n  return function () {\n    const res = taro.getSystemInfoSync?.()\n\n    if (!res) {\n      if (process.env.NODE_ENV !== 'production') {\n        console.error('不支持 API canIUseWebp')\n      }\n      return false\n    }\n\n    const { platform } = res\n\n    const platformLower = platform.toLowerCase()\n    if (platformLower === 'android' || platformLower === 'devtools') {\n      return true\n    }\n    return false\n  }\n}\n\nfunction getNormalRequest (global) {\n  return function request (options) {\n    options = options\n      ? (\n        isString(options)\n          ? { url: options }\n          : options\n      )\n      : {}\n\n    const originSuccess = options.success\n    const originFail = options.fail\n    const originComplete = options.complete\n    let requestTask\n    const p: any = new Promise((resolve, reject) => {\n      options.success = res => {\n        originSuccess && originSuccess(res)\n        resolve(res)\n      }\n      options.fail = res => {\n        originFail && originFail(res)\n        reject(res)\n      }\n\n      options.complete = res => {\n        originComplete && originComplete(res)\n      }\n\n      requestTask = global.request(options)\n    })\n\n    equipTaskMethodsIntoPromise(requestTask, p)\n\n    p.abort = (cb) => {\n      cb && cb()\n      if (requestTask) {\n        requestTask.abort()\n      }\n      return p\n    }\n    return p\n  }\n}\n\nfunction processApis (taro, global, config: IProcessApisIOptions = {}) {\n  const patchNeedPromiseApis = config.needPromiseApis || []\n  const _needPromiseApis = new Set<string>([...patchNeedPromiseApis, ...needPromiseApis])\n  const preserved = [\n    'getEnv',\n    'interceptors',\n    'Current',\n    'getCurrentInstance',\n    'options',\n    'nextTick',\n    'eventCenter',\n    'Events',\n    'preload',\n    'webpackJsonp'\n  ]\n\n  const apis = new Set(\n    !config.isOnlyPromisify\n      ? Object.keys(global).filter(api => preserved.indexOf(api) === -1)\n      : patchNeedPromiseApis\n  )\n\n  if (config.modifyApis) {\n    config.modifyApis(apis)\n  }\n\n  apis.forEach(key => {\n    if (_needPromiseApis.has(key)) {\n      const originKey = key\n      taro[originKey] = (options: Record<string, any> | string = {}, ...args) => {\n        let key = originKey\n\n        // 第一个参数 options 为字符串，单独处理\n        if (typeof options === 'string') {\n          if (args.length) {\n            return global[key](options, ...args)\n          }\n          return global[key](options)\n        }\n\n        // 改变 key 或 option 字段，如需要把支付宝标准的字段对齐微信标准的字段\n        if (config.transformMeta) {\n          const transformResult = config.transformMeta(key, options)\n          key = transformResult.key\n          ; (options as Record<string, any>) = transformResult.options\n          // 新 key 可能不存在\n          if (!global.hasOwnProperty(key)) {\n            return nonsupport(key)()\n          }\n        }\n\n        let task: any = null\n        const obj: Record<string, any> = Object.assign({}, options)\n\n        // 为页面跳转相关的 API 设置一个随机数作为路由参数。为了给 runtime 区分页面。\n        setUniqueKeyToRoute(key, options)\n\n        // Promise 化\n        const p: any = new Promise((resolve, reject) => {\n          obj.success = res => {\n            config.modifyAsyncResult?.(key, res)\n            options.success?.(res)\n            if (key === 'connectSocket') {\n              resolve(\n                Promise.resolve().then(() => task ? Object.assign(task, res) : res)\n              )\n            } else {\n              resolve(res)\n            }\n          }\n          obj.fail = res => {\n            options.fail?.(res)\n            reject(res)\n          }\n          obj.complete = res => {\n            options.complete?.(res)\n          }\n          if (args.length) {\n            task = global[key](obj, ...args)\n          } else {\n            task = global[key](obj)\n          }\n        })\n\n        // 给 promise 对象挂载属性\n        if (['uploadFile', 'downloadFile'].includes(key)) {\n          equipTaskMethodsIntoPromise(task, p)\n          p.progress = cb => {\n            task?.onProgressUpdate(cb)\n            return p\n          }\n          p.abort = cb => {\n            cb?.()\n            task?.abort()\n            return p\n          }\n        }\n        return p\n      }\n    } else {\n      let platformKey = key\n\n      // 改变 key 或 option 字段，如需要把支付宝标准的字段对齐微信标准的字段\n      if (config.transformMeta) {\n        platformKey = config.transformMeta(key, {}).key\n      }\n\n      // API 不存在\n      if (!global.hasOwnProperty(platformKey)) {\n        taro[key] = nonsupport(key)\n        return\n      }\n      if (isFunction(global[key])) {\n        taro[key] = (...args) => {\n          if (config.handleSyncApis) {\n            return config.handleSyncApis(key, global, args)\n          } else {\n            return global[platformKey].apply(global, args)\n          }\n        }\n      } else {\n        taro[key] = global[platformKey]\n      }\n    }\n  })\n\n  !config.isOnlyPromisify && equipCommonApis(taro, global, config)\n}\n\n/**\n * 挂载常用 API\n * @param taro Taro 对象\n * @param global 小程序全局对象，如微信的 wx，支付宝的 my\n */\nfunction equipCommonApis (taro, global, apis: Record<string, any> = {}) {\n  taro.canIUseWebp = getCanIUseWebp(taro)\n  taro.getCurrentPages = getCurrentPages || nonsupport('getCurrentPages')\n  taro.getApp = getApp || nonsupport('getApp')\n  taro.env = global.env || {}\n\n  try {\n    taro.requirePlugin = requirePlugin || nonsupport('requirePlugin')\n  } catch (error) {\n    taro.requirePlugin = nonsupport('requirePlugin')\n  }\n\n  // request & interceptors\n  const request = apis.request || getNormalRequest(global)\n  function taroInterceptor (chain) {\n    return request(chain.requestParams)\n  }\n  const link = new taro.Link(taroInterceptor)\n  taro.request = link.request.bind(link)\n  taro.addInterceptor = link.addInterceptor.bind(link)\n  taro.cleanInterceptors = link.cleanInterceptors.bind(link)\n  taro.miniGlobal = taro.options.miniGlobal = global\n  taro.getAppInfo = function () {\n    return {\n      platform: process.env.TARO_PLATFORM || 'MiniProgram',\n      taroVersion: process.env.TARO_VERSION || 'unknown',\n      designWidth: taro.config.designWidth\n    }\n  }\n  taro.createSelectorQuery = delayRef(taro, global, 'createSelectorQuery', 'exec')\n  taro.createIntersectionObserver = delayRef(taro, global, 'createIntersectionObserver', 'observe')\n}\n\n/**\n * 将Task对象中的方法挂载到promise对象中，适配小程序api原生返回结果\n * @param task Task对象 {RequestTask | DownloadTask | UploadTask}\n * @param promise Promise\n */\nfunction equipTaskMethodsIntoPromise (task, promise) {\n  if (!task || !promise) return\n  const taskMethods = ['abort', 'onHeadersReceived', 'offHeadersReceived', 'onProgressUpdate', 'offProgressUpdate', 'onChunkReceived', 'offChunkReceived']\n  task && taskMethods.forEach(method => {\n    if (method in task) {\n      promise[method] = task[method].bind(task)\n    }\n  })\n}\n\nfunction delayRef (taro, global, name: string, method: string) {\n  return function (...args) {\n    const res = global[name](...args)\n    const raw = res[method].bind(res)\n    res[method] = function (...methodArgs) {\n      taro.nextTick(() => raw(...methodArgs))\n    }\n    return res\n  }\n}\n\nexport {\n  processApis\n}\n"],"names":[],"mappings":"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"}