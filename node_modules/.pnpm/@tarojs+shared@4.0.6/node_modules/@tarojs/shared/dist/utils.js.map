{"version":3,"file":"utils.js","sources":["../src/utils.ts"],"sourcesContent":["import { internalComponents } from './components'\nimport { PLATFORM_CONFIG_MAP, PLATFORM_TYPE } from './constants'\nimport { hooks } from './runtime-hooks'\n\nexport const EMPTY_OBJ: any = {}\n\nexport const EMPTY_ARR = []\n\nexport const noop = (..._: unknown[]) => {}\n\n/**\n * Boxed value.\n *\n * @typeparam T Value type.\n */\nexport interface Box<T> {\n  v: T\n}\n\n/**\n * box creates a boxed value.\n *\n * @typeparam T Value type.\n * @param v Value.\n * @returns Boxed value.\n */\nexport const box = <T>(v: T) => ({ v })\n\n/**\n * box creates a boxed value.\n *\n * @typeparam T Value type.\n * @param b Boxed value.\n * @returns Value.\n */\nexport const unbox = <T>(b: Box<T>) => b.v\n\nexport function toDashed (s: string) {\n  return s.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase()\n}\n\nexport function toCamelCase (s: string) {\n  let camel = ''\n  let nextCap = false\n  for (let i = 0; i < s.length; i++) {\n    if (s[i] !== '-') {\n      camel += nextCap ? s[i].toUpperCase() : s[i]\n      nextCap = false\n    } else {\n      nextCap = true\n    }\n  }\n  return camel\n}\n\nexport const toKebabCase = function (string) {\n  return string.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase()\n}\n\nexport function capitalize (s: string) {\n  return s.charAt(0).toUpperCase() + s.slice(1)\n}\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty\n\nexport const hasOwn = (\n  val: Record<any, any>,\n  key: string | symbol\n) => hasOwnProperty.call(val, key)\n\n/**\n * ensure takes a condition and throw a error if the condition fails,\n * like failure::ensure: https://docs.rs/failure/0.1.1/failure/macro.ensure.html\n * @param condition condition.\n * @param msg error message.\n */\nexport function ensure (condition: boolean, msg: string): asserts condition {\n  if (!condition) {\n    if (process.env.NODE_ENV !== 'production') {\n      const reportIssue = '\\n如有疑问，请提交 issue 至：https://github.com/nervjs/taro/issues'\n      throw new Error(msg + reportIssue)\n    } else {\n      throw new Error(msg)\n    }\n  }\n}\n\nexport function warn (condition: boolean, msg: string) {\n  if (process.env.NODE_ENV !== 'production') {\n    if (condition) {\n      console.warn(`[taro warn] ${msg}`)\n    }\n  }\n}\n\nexport function queryToJson (str) {\n  const dec = decodeURIComponent\n  const qp = str.split('&')\n  const ret = {}\n  let name\n  let val\n  for (let i = 0, l = qp.length, item; i < l; ++i) {\n    item = qp[i]\n    if (item.length) {\n      const s = item.indexOf('=')\n      if (s < 0) {\n        name = dec(item)\n        val = ''\n      } else {\n        name = dec(item.slice(0, s))\n        val = dec(item.slice(s + 1))\n      }\n      if (typeof ret[name] === 'string') { // inline'd type check\n        ret[name] = [ret[name]]\n      }\n\n      if (Array.isArray(ret[name])) {\n        ret[name].push(val)\n      } else {\n        ret[name] = val\n      }\n    }\n  }\n  return ret // Object\n}\n\nlet _uniqueId = 1\nconst _loadTime = (new Date()).getTime().toString()\n\nexport function getUniqueKey () {\n  return _loadTime + (_uniqueId++)\n}\n\nconst cacheData = {}\n\nexport function cacheDataSet (key, val) {\n  cacheData[key] = val\n}\n\nexport function cacheDataGet (key, delelteAfterGet?) {\n  const temp = cacheData[key]\n  delelteAfterGet && delete cacheData[key]\n  return temp\n}\n\nexport function cacheDataHas (key) {\n  return key in cacheData\n}\n\nexport function mergeInternalComponents (components) {\n  Object.keys(components).forEach(name => {\n    if (name in internalComponents) {\n      Object.assign(internalComponents[name], components[name])\n    } else {\n      internalComponents[name] = components[name]\n    }\n  })\n  return internalComponents\n}\n\nexport function getComponentsAlias (origin: typeof internalComponents) {\n  const mapping = {}\n  const viewAttrs = origin.View\n  const extraList = {\n    '#text': {},\n    StaticView: viewAttrs,\n    StaticImage: origin.Image,\n    StaticText: origin.Text,\n    PureView: viewAttrs,\n    CatchView: viewAttrs\n  }\n  origin = { ...origin, ...extraList }\n  Object.keys(origin)\n    .sort((a, b) => {\n      const reg = /^(Static|Pure|Catch)*(View|Image|Text)$/\n      const isACommonly = reg.test(a)\n      const isBCommonly = reg.test(b)\n      if (isACommonly && isBCommonly) {\n        return a > b ? 1 : -1\n      } else if (isACommonly) {\n        return -1\n      } else if (isBCommonly) {\n        return 1\n      } else {\n        return a >= b ? 1 : -1\n      }\n    })\n    .forEach((key, num) => {\n      const obj = {\n        _num: String(num)\n      }\n      Object.keys(origin[key])\n        .filter(attr => !(/^bind/.test(attr)) && !['focus', 'blur'].includes(attr))\n        .sort()\n        .forEach((attr, index) => {\n          obj[toCamelCase(attr)] = 'p' + index\n        })\n      mapping[toDashed(key)] = obj\n    })\n\n  return mapping\n}\n\nexport function getPlatformType (platform = 'weapp', configNameOrType: string = PLATFORM_TYPE.MINI): PLATFORM_TYPE {\n  if (Object.keys(PLATFORM_CONFIG_MAP).includes(platform)) {\n    configNameOrType = platform\n  }\n  const param = PLATFORM_CONFIG_MAP[configNameOrType] || {}\n  return param.type || configNameOrType\n}\n\nexport function mergeReconciler (hostConfig, hooksForTest?) {\n  const obj = hooksForTest || hooks\n  const keys = Object.keys(hostConfig)\n  keys.forEach(key => {\n    obj.tap(key, hostConfig[key])\n  })\n}\n\nexport function nonsupport (api) {\n  return function () {\n    console.warn(`小程序暂不支持 ${api}`)\n  }\n}\n\nexport function setUniqueKeyToRoute (key: string, obj) {\n  const routerParamsPrivateKey = '__key_'\n  const useDataCacheApis = [\n    'navigateTo',\n    'redirectTo',\n    'reLaunch',\n    'switchTab'\n  ]\n\n  if (useDataCacheApis.indexOf(key) > -1) {\n    const url = obj.url = obj.url || ''\n    const hasMark = url.indexOf('?') > -1\n    const cacheKey = getUniqueKey()\n    obj.url += (hasMark ? '&' : '?') + `${routerParamsPrivateKey}=${cacheKey}`\n  }\n}\n\nexport function indent (str: string, size: number): string {\n  return str.split('\\n')\n    .map((line, index) => {\n      const indent = index === 0 ? '' : Array(size).fill(' ').join('')\n      return indent + line\n    })\n    .join('\\n')\n}\n"],"names":[],"mappings":"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"}